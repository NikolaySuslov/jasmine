'From Squeak3.6 of ''6 October 2003'' [latest update: #5429] on 6 February 2004 at 9:19:24 pm'!"Change Set:		MethodAnnotations-arDate:			2 January 2002Author:			Andreas RaabWARNING: This CS has been manually re-arranged.Optional annotation for methods. All <mumble> expressions are now treated as property of the compiled method. In other words, a method may look like:Object>>mumble	<categories: #(basic eToy)>	<index: 42>	<value: 123.45>	<returnType: Array>After the method is compiled we may query it for those properties as in:	(Object compiledMethodAt: #mumble)		valueOfProperty: #categories; 	=> #(basic eToy)		valueOfProperty: #index;		=> 42		valueOfProperty: #value;		=> 123.45		valueOfProperty: #returnType.	=> Array"CompiledMethod addClassVarName: 'MethodProperties'.!!CompiledMethod methodsFor: 'literals' stamp: 'ar 1/4/2002 00:32'!hasLiteralThorough: literal	"Answer true if any literal in this method is literal,	even if embedded in array structure."	| lit |	self properties ifNotNilDo:[:dict| (dict includesKey: literal) ifTrue:[^true]].	2 to: self numLiterals + 1 do: 		[:index | 		(lit _ self objectAt: index) == literal ifTrue: [^ true].		(lit class == Array and: [lit hasLiteral: literal]) ifTrue: [^ true]].	^ false ! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 1/4/2002 00:28'!properties	^MethodProperties ifNotNil:[MethodProperties at: self ifAbsent:[nil]]! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 2/19/2003 16:38'!properties: propDict	MethodProperties ifNotNil:[		propDict isEmptyOrNil			ifTrue:[MethodProperties removeKey: self ifAbsent:[]]			ifFalse:[MethodProperties at: self put: propDict]]! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 1/4/2002 00:32'!removeProperty: propName	| props |	props _ self properties ifNil:[^self].	props removeKey: propName ifAbsent:[].	props isEmpty ifTrue:[self properties: nil].! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 1/4/2002 00:30'!setProperty: propName toValue: aValue	| props |	props _ self properties.	props ifNil:[		props _ IdentityDictionary new.		self properties: props].	props at: propName put: aValue.! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 1/4/2002 00:25'!valueOfProperty: propName	^self valueOfProperty: propName ifAbsent:[nil]! !!CompiledMethod methodsFor: 'properties' stamp: 'ar 1/4/2002 00:31'!valueOfProperty: propName ifAbsent: aBlock	| props |	props _ self properties ifNil:[^aBlock value].	^props at: propName ifAbsent: aBlock! !!CompiledMethod class methodsFor: 'class initialization'!shutDown: aboutToQuit	"The system is going down - clean out method properties"	MethodProperties finalizeValues.!initialize    "CompiledMethod initialize"	"Initialize class variables specifying the size of the temporary frame	needed to run instances of me."	SmallFrame _ 16.	"Context range for temps+stack"	LargeFrame _ 56.	MethodProperties ifNil:[MethodProperties _ WeakIdentityKeyDictionary new].	Smalltalk addToShutDownList: self.! !CompiledMethod initialize!